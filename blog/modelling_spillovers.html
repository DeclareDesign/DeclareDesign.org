<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.79.1" />


  <title>Instead of avoiding spillovers, you can model them - DeclareDesign</title>




  









<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css'>



<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>

<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">

<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>






  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Instead of avoiding spillovers, you can model them">
  <meta name="twitter:description" content='Spillovers are often seen as a nuisance that lead researchers into error when estimating effects of interest. In a previous post, we discussed sampling strategies to reduce these risks. A more substantively satisfying approach is to try to study spillovers directly. If we do it right we can remove errors in our estimation of primary quantities of interest and learn about how spillovers work at the same time.

'>






<script src="/js/dropdown_menu.js"></script>
<link rel="stylesheet" href="/css/custom.css">

  </head>
  <body>
    <div class="wrapper">
      
        
<header>
  <div class="navbar-wrap fixed-top bg-white">
    <nav class="navbar navbar-expand-lg navbar-light">
      <div class="container-fluid"> <a class="navbar-brand" href="/"><img src="/images/brand.svg" alt=""></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item"><a class="nav-link" href="/getting-started.html">Getting Started</a></li>
            <li class="nav-item"><a class="nav-link" href="/r/designlibrary">Library</a></li>
            <li class="nav-item dropdown">
              
              <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Software <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="/r/declaredesign/">DeclareDesign</a></li>
                <li><a class="dropdown-item" href="/r/randomizr/">randomizr</a></li>
                <li><a class="dropdown-item" href="/r/fabricatr/">fabricatr</a></li>
                <li><a class="dropdown-item" href="/r/estimatr/">estimatr</a></li>
                <li><a class="dropdown-item" href="/r/designlibrary/">DesignLibrary</a></li>
              </ul>
            </li>
            <li class="nav-item"><a class="nav-link" href="/blog.html">Blog</a></li>
            <li class="nav-item"><a class="nav-link" href="/about.html">About</a></li>
            <li class="nav-item"><a target="_blank" class="nav-link" href="http://discuss.declaredesign.org/">Help</a></li>
          </ul>
        </div>
      </div>
    </nav>
  </div>
</header>

 

      


<main class="container">
  <div class="row justify-content-between">
    <div class="col-lg-12" id="content_column">
      <article class="article">

        <a class="h1 d-block mb-3" href="/blog">DeclareDesign Blog</a>
        <h2 class="article-title">Instead of avoiding spillovers, you can model them</h2>

        
        <span class="article-date">2018/11/20</span>
        

        <div class="article-content">
          


<p>Spillovers are often seen as a nuisance that lead researchers into error when estimating effects of interest. In a <a href="https://declaredesign.org/blog/2018-09-18-spillovers.html">previous post,</a> we discussed sampling strategies to reduce these risks. A more substantively satisfying approach is to try to study spillovers directly. If we do it right we can remove errors in our estimation of primary quantities of interest and learn about how spillovers work at the same time.</p>
<p>This is important because spillovers are <em>part</em> of the overall effects of an intervention. If vaccination of one subject improves health outcomes for another, then this gain needs to be understood to assess the total benefits of vaccination. This is hard because we are not used to thinking of spillover effects as estimands, or to writing them in terms of potential outcomes, and so we generally do not think in terms of bias or power for spillover effects. But we can.</p>
<div id="a-spillover-design-and-the-idea-of-an-indirect-treatment" class="section level1">
<h1>A spillover design and the idea of an indirect treatment</h1>
<p>We declare a design based on the <code>spillover_designer</code> in the <code>DesignLibrary</code> package.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>In this design there are 80 groups, each of size 3. Treatment is randomly assigned—ignoring groups. Outcomes do depend on group membership, however. In particular, any individual’s outcome depends on the number of individuals in the group treated. A function (<code>dgp</code>) specifies how group assignments map into individual payoffs.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<pre class="r"><code>dgp &lt;- function(i, Z, G) Z[i]/3 + sum(Z[G == G[i]])^2/5 + rnorm(1)

spillover_design &lt;- 

  declare_population(G = add_level(N = 80), 
                     j = add_level(N = 3, zeros = 0, ones = 1)) +
  
  declare_estimand(direct = mean(sapply(1:240,  # just i treated v no one treated 
    function(i) { Z_i &lt;- (1:240) == i
                  dgp(i, Z_i, G) - dgp(i, zeros, G)}))) +
  
  declare_estimand(indirect = mean(sapply(1:240, 
    function(i) { Z_i &lt;- (1:240) == i           # all but i treated v no one treated   
                  dgp(i, ones - Z_i, G) - dgp(i, zeros, G)}))) +
  
  declare_assignment() + 
  
  declare_step(handler = fabricate,
               neighbors_treated = sapply(1:N, function(i) sum(Z[-i][G[-i] == G[i]])),
               one_neighbor  = as.numeric(neighbors_treated == 1),
               two_neighbors = as.numeric(neighbors_treated == 2)) +
  
  declare_reveal(handler = fabricate, Y = sapply(1:N, function(i) dgp(i, Z, G))) +

  declare_estimator(Y ~ Z, 
                    estimand = &quot;direct&quot;, 
                    model = lm_robust, 
                    label = &quot;naive&quot;) +
  
  declare_estimator(Y ~ Z * one_neighbor + Z * two_neighbors,
                    term = c(&quot;Z&quot;, &quot;two_neighbors&quot;),
                    estimand = c(&quot;direct&quot;, &quot;indirect&quot;), 
                    label = &quot;saturated&quot;, 
                    model = lm_robust)</code></pre>
<p>The key feature of this design is that units belong in <strong>groups</strong>. When a unit gets treated, the effect of the treatment spreads out across other group members (but no further).</p>
<p>In this kind of setting, we can say you get <strong>indirectly</strong> treated when someone in your group – your “neighbor” – gets treated. In this case, we might think of the <strong>number of neighbors treated</strong> in a given assignment as your indirect treatment. For three-member groups, this definition of spillovers implies every unit has at least six potential outcomes <span class="math inline">\(Y_{z,n}\)</span>. For example, <span class="math inline">\(Y_{1,2}\)</span> is the potential outcome for a unit who is treated in a group where both other members are treated, while <span class="math inline">\(Y_{1,0}\)</span> is the potential outcome for a unit when they are the only member treated in their group.</p>
<p>If we plot the units in groups using colors for their individual treatment status and labeling them with the number of neighbors treated, one set of assignments for a sample of groups might look like this:</p>
<p><img src="/blog/2018-11-20-Spillovers_Modelled_files/figure-html/unnamed-chunk-2-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>There are two notable departures from the design we looked at before. First, we declare an estimand for indirect effects and not just for direct effects. For direct effects we focus on the effect of being treated given no neighbors are treated (<span class="math inline">\(E[Y_{1,0} - Y_{0,0}]\)</span>). For indirect effects we focus on the effect for an individual of having everyone else treated given that they themselves are not treated (<span class="math inline">\(E[Y_{0,2} - Y_{0,0}]\)</span>).<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> Importantly, this <strong>estimand</strong> is defined in terms of potential outcomes rather than being dependent on a particular model.</p>
<p>Second, alongside the naive estimator, we use an estimator that seeks to model the direct and indirect effects directly. By modelling indirect effects in the estimation step, we can seek to estimate the average direct treatment effect without bias and conditional on the number of neighbors treated.</p>
<p>In this context, where the spillover mechanism is well-understood and captured by the statistical model, our modelling approach does a great job of removing bias. Here we show the estimated effects of being treated when no others are treated (direct effect) and of not being treated when all others are treated (indirect effect). We see the mean estimate (dashed blue line) is right on the mean estimand (solid red line) in both cases when we model the spillovers:</p>
<p><img src="/blog/2018-11-20-Spillovers_Modelled_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Power for all estimates now looks like this:</p>
<p><img src="/blog/2018-11-20-Spillovers_Modelled_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>We have great power for the naive estimator – but only because it confidently delivers the wrong answer! The power from the saturated model is not so great, especially for the direct effect.</p>
</div>
<div id="you-can-use-assignment-to-improve-power-in-the-presence-of-spillovers" class="section level1">
<h1>You can use assignment to improve power in the presence of spillovers</h1>
<p>One approach to increase power for the direct effect is to tweak the assignment to control the number of groups that have one or two members treated.</p>
<p>Doing this may produce tradeoffs, however, between power for direct effects and power for indirect effects.</p>
<p>The current assignment just assigns units to treatment with .5 probability, ignoring groups. We’ll replace that step with a new assignment strategy where we directly control whether groups get 0, 1, or 2 members treated. (This kind of design is sometimes called a randomized saturation design.)</p>
<p>We declare a custom assignment that uses a two-stage procedure, in which we first assign groups to treatment densities, then assign units to treatment conditional on their group’s density.</p>
<pre class="r"><code>two_stage &lt;- function(data, density_probs){
  density &lt;- with(data, cluster_ra(clusters = unique(G), 
                                   conditions = c(0,1,2),
                                   prob_each = density_probs))
  data$Z &lt;- with(data, block_ra(blocks = G, block_m = density))
  return(data)
}</code></pre>
<p>Let’s compare two different first-stage approaches: one where we assign more of our groups to have 0 or 1 members treated, and another in which we assign more to have 0 or 2 members treated.</p>
<pre class="r"><code>spillovers_assigned_1 &lt;- 
  replace_step(
    design = spillover_design, 
    step  =  4, 
    new_step = declare_assignment(handler = two_stage, 
                                  density_probs = c(.45,.45,.1)))
spillovers_assigned_2 &lt;- 
  replace_step(
    design = spillover_design, 
    step  =  4, 
    new_step = declare_assignment(handler = two_stage, 
                                  density_probs = c(.45,.1,.45)))</code></pre>
<p>Now power looks like this:</p>
<p><img src="/blog/2018-11-20-Spillovers_Modelled_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>We see a large gain in power for the estimation of direct effects when assigning more groups to have 0 or 1 member treated, and a big loss when assigning fewer groups to those densities in favor of having 2 members treated. We see an opposite tradeoff for the estimation of indirect effects. Optimal assignment depends on the quantities of interest. See <span class="citation">Baird et al. (2017)</span> for a great treatment of these issues.</p>
</div>
<div id="some-warnings" class="section level1">
<h1>Some warnings</h1>
<p>We got things right in part because we were right about the structure of spillovers. The estimation strategy did not assume much about the functional form of the spillovers but it <em>did</em> require being right about spillovers being contained within groups. If, in addition to the spillovers that we modeled, there were also spillovers between groups, then the estimation strategy would get things wrong in much the same way as the naive approach that ignored spillovers within groups got things wrong. So you need to use knowledge about the structure of spillovers. An interesting exercise is to alter the dgp function so that outcomes also depend on <code>Z[1]</code>—the treatment status of person number 1. How would that alter things?</p>
<p>Less obvious, perhaps, things were easy here because the group sizes were homogeneous. Why does that matter? The reason is that in this example uniform assignment probabilities for the direct treatment translated into uniform assignment probabilities for the indirect treatments. But generally you cannot count on this. In this case, if groups were of heterogeneous size and treatment was randomly assigned, then units in big groups would be more likely to be exposed to treatment indirectly than units in small groups: a unit in a group of size 3 would be less likely to have two neighbors treated (<code>prob = .25</code>) than a unit in a group of size 4 (<code>prob = 3/8</code>).
This can produce bias if treatment effects also depend on group size. To remove the bias you would need to take account of the fact that the indirect treatments were assigned with unequal propensities (even though the direct treatments were assigned to all units with the same probability!). This is a very similar issue to <a href="https://declaredesign.org/blog/biased-fixed-effects.html">one we discussed here</a>, and some of those approaches to addressing bias arising from heterogeneous (indirect) assignment propensities can also help in the spillover context.</p>
<p>Also not too obvious, even if direct treatments are assigned independently, assignment of indirect treatments might be clustered. For example everyone in a family gets indirectly treated together when one member gets directly treated. Given the possibly complex nature of clustering, it might make sense to use <a href="https://egap.org/methods-guides/10-things-randomization-inference">randomization inference</a> for hypothesis testing is this setting.</p>
<p>For more on this topic, including strategies for estimating uncertainty given indirect treatment, see, for example, <span class="citation">Aronow and Samii (2017)</span>.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-aronow2017estimating">
<p>Aronow, Peter M, and Cyrus Samii. 2017. “Estimating Average Causal Effects Under General Interference, with Application to a Social Network Experiment.” <em>The Annals of Applied Statistics</em> 11 (4): 1912–47.</p>
</div>
<div id="ref-baird2017optimal">
<p>Baird, Sarah, J Aislinn Bohren, Craig McIntosh, and Berk Özler. 2017. “Optimal Design of Experiments in the Presence of Interference.” <em>Review of Economics and Statistics</em>, no. 0.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>As with any design from the library, you can always look at the underlying code using <code>get_design_code(spillover_designer())</code>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>This dgp function differs from what we examined before by having spillovers that are not complete: direct effects differ from indirect effects.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>In fact if you look a the design declaration we are a little more thorough and define the estimand in terms of the treatment status of <em>all individuals</em> and not just the in-group members.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>

        </div>
      </article>
      



    </div>
  </div>
</main>

    </div>

    

<footer>
    <div class="footer-top">
      <div class="container">
        <div class="row no-gutters">
          <div class="col-lg-7 col-md-12">
            <div class="row">
              <div class="col-md-3 col-12">
                <div class="footer-brand"><a href=""><img src="/images/brand-footer.svg" alt=""></a></div>
              </div>
              <div class="col-md-3 col-4">
                <p>DeclareDesign</p>
                <ul class="list-unstyled">
                  <li><a href="/">Home</a></li>
                  <li><a href="/about.html">About</a></li>
                  <li><a href="/r/designlibrary">Library</a></li>
                  <li><a href="/blog.html">Blog</a></li>
                  <li><a href="http://discuss.declaredesign.org/">Help</a></li>
                </ul>
              </div>
              <div class="col-md-3 col-4">
                <p>Software</p>
                <ul class="list-unstyled">
                  <li><a href="/r/declaredesign/">DeclareDesign</a></li>
                  <li><a href="/r/estimatr/">estimatr</a></li>
                  <li><a href="/r/randomizr/">randomizr</a></li>
                  <li><a href="/r/fabricatr/">fabricatr</a></li>
                  <li><a href="/r/designlibrary/">DesignLibrary</a></li>
                </ul>
              </div>
              
            </div>
          </div>
          <div class="col-lg-5 col-md-12"></div>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <div class="footer-meta-block">
        <div class="container">
          <div class="row align-items-center">
            <div class="col-sm-7">
              <p class="mb-0">&copy; 2021 Graeme Blair, Jasper Cooper, Alexander Coppock, and Macartan Humphreys</p>
            </div>
            <div class="col-sm-5">
              <div class="fbl-link-wrap">
                <ul class="list-inline mb-0">
                  <li class="list-inline-item"> <a target="_blank" href="http://github.com/DeclareDesign/"><img src="images/icon-git.svg" alt=""></a> </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
  
   
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/v/bs4/dt-1.10.18/datatables.min.css"/>
<script src="https://cdn.datatables.net/v/bs4/dt-1.10.18/datatables.min.js"></script>

<script>
    jQuery(function ()
    {
        const library_list = jQuery("#design_library_list");
        library_list.addClass("table table-striped table-bordered");
        library_list.DataTable(
            {
                "autoWidth": false,
                "columns":
                    [
                        {"width": "30%"}, 
                        {"width": "10%"}, 
                        {"width": "10%"}, 
                        {"width": "10%"}, 
                        {"width": "15%"}, 
                        {"width": "25%"}, 
                    ],
                "drawCallback": initialize_tooltips
            }
        );

        library_list.css("width", "");
    });

    function initialize_tooltips()
    {
        const tooltip_elements = jQuery('[data-toggle="tooltip"]');
        tooltip_elements.tooltip();
        tooltip_elements.click(function ()
        {
            jQuery(this).tooltip("hide");
        });
    }
</script>

    


<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>
jQuery(function ()
{
  $('pre').each(function (index)
  {
    hljs.highlightBlock(this);
  });
});
</script>



    
<script src="/js/math-code.js"></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    



    
  </body>
</html>

