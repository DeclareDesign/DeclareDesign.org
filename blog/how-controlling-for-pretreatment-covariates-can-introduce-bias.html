<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.79.1" />


  <title>How controlling for pretreatment covariates can introduce bias - DeclareDesign</title>




  









<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css'>



<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>

<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">

<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>






  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="How controlling for pretreatment covariates can introduce bias">
  <meta name="twitter:description" content='Consider an observational study looking at the effect of a non-randomly assigned treatment, (Z), on an outcome (Y). Say you have a pretreatment covariate, (X), that is correlated with both (Z) and (Y). Should you control for (X) when you try to assess the effect of (Z) on (Y)?

'>






<script src="/js/dropdown_menu.js"></script>
<link rel="stylesheet" href="/css/custom.css">

  </head>
  <body>
    <div class="wrapper">
      
        
<header>
  <div class="navbar-wrap fixed-top bg-white">
    <nav class="navbar navbar-expand-lg navbar-light">
      <div class="container-fluid"> <a class="navbar-brand" href="/"><img src="/images/brand.svg" alt=""></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item"><a class="nav-link" href="/getting-started.html">Getting Started</a></li>
            <li class="nav-item"><a class="nav-link" href="/r/designlibrary">Library</a></li>
            <li class="nav-item dropdown">
              
              <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Software <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="/r/declaredesign/">DeclareDesign</a></li>
                <li><a class="dropdown-item" href="/r/randomizr/">randomizr</a></li>
                <li><a class="dropdown-item" href="/r/fabricatr/">fabricatr</a></li>
                <li><a class="dropdown-item" href="/r/estimatr/">estimatr</a></li>
                <li><a class="dropdown-item" href="/r/designlibrary/">DesignLibrary</a></li>
              </ul>
            </li>
            <li class="nav-item"><a class="nav-link" href="/blog.html">Blog</a></li>
            <li class="nav-item"><a class="nav-link" href="/about.html">About</a></li>
            <li class="nav-item"><a target="_blank" class="nav-link" href="http://discuss.declaredesign.org/">Help</a></li>
          </ul>
        </div>
      </div>
    </nav>
  </div>
</header>

 

      


<main class="container">
  <div class="row justify-content-between">
    <div class="col-lg-12" id="content_column">
      <article class="article">

        <a class="h1 d-block mb-3" href="/blog">DeclareDesign Blog</a>
        <h2 class="article-title">How controlling for pretreatment covariates can introduce bias</h2>

        
        <span class="article-date">2018/09/12</span>
        

        <div class="article-content">
          


<p>Consider an observational study looking at the effect of a non-randomly assigned treatment, <span class="math inline">\(Z\)</span>, on an outcome <span class="math inline">\(Y\)</span>. Say you have a pretreatment covariate, <span class="math inline">\(X\)</span>, that is correlated with both <span class="math inline">\(Z\)</span> and <span class="math inline">\(Y\)</span>. Should you control for <span class="math inline">\(X\)</span> when you try to assess the effect of <span class="math inline">\(Z\)</span> on <span class="math inline">\(Y\)</span>?</p>
<p>This has been a question of some disagreement, with <span class="citation">Rosenbaum (2002)</span>, for instance, arguing that “there is little to no reason to avoid adjustment for a true covariate, a variable describing subjects before treatment,” and <span class="citation">Greenland, Pearl, and Robins (1999)</span> and others arguing that you cannot answer this question without a causal model of how <span class="math inline">\(Z\)</span> relates to <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. See also <a href="https://andrewgelman.com/2009/07/23/pearls_and_gelm/">this</a> discussion hosted by Andy Gelman. Controlling for pretreatment covariates in a randomized experiment usually can’t hurt and usually increases precision – but what about in an observational study in which pretreatment covariates might be correlated with both the (nonrandomly assigned) treatment and the outcome?</p>
<p>Design declaration and diagnosis makes it relatively simple to examine the kinds of cases that worry Greenland et al and see where risks of bias might come from.</p>
<p>Let’s declare a design with a model of the form:</p>
<ul>
<li><span class="math inline">\(X = f_1(U_1, U_2)\)</span></li>
<li><span class="math inline">\(Z = f_2(U_2)\)</span></li>
<li><span class="math inline">\(Y = f_3(Z, U_1)\)</span></li>
</ul>
<p>In this world, <span class="math inline">\(X\)</span> is a function of background unobserved variables <span class="math inline">\(U_1\)</span> and <span class="math inline">\(U_2\)</span>, a treatment variable <span class="math inline">\(Z\)</span> is a function of <span class="math inline">\(U_2\)</span>, and an outcome <span class="math inline">\(Y\)</span> is a function of <span class="math inline">\(Z\)</span> and <span class="math inline">\(U_1\)</span>. We can assume that that <span class="math inline">\(X\)</span> is determined prior to <span class="math inline">\(Z\)</span>. We will use two answer strategies, both regression based approaches, one with a control and one without.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Here is the full declaration:</p>
<pre class="r"><code># Parameters
b &lt;- 1
N &lt;- 40

# Declaration
population &lt;- declare_population(N = N, U_1 = rnorm(N), U_2 = rnorm(N),
                                 X = U_1 + U_2, Z  = 1 * (U_2 &gt; 0))
potentials &lt;- declare_potential_outcomes(Y ~ b * Z + U_1)
estimand   &lt;- declare_estimand(ate = mean(Y_Z_1 - Y_Z_0))
reveal_Y   &lt;- declare_reveal()
answer_1   &lt;- declare_estimator(Y ~ Z, estimand = &quot;ate&quot;,
                                model = lm_robust, label = &quot;No control&quot;)
answer_2   &lt;- declare_estimator(Y ~ Z + X, estimand = &quot;ate&quot;,
                                model = lm_robust, label = &quot;With control&quot;)

design &lt;- population + potentials + estimand + reveal_Y + answer_1 + answer_2</code></pre>
<p>Here is the diagnosis:</p>
<pre class="r"><code>diagnosis &lt;- diagnose_design(design)</code></pre>
<table style="width:100%;">
<colgroup>
<col width="9%" />
<col width="11%" />
<col width="12%" />
<col width="4%" />
<col width="3%" />
<col width="4%" />
<col width="6%" />
<col width="10%" />
<col width="9%" />
<col width="6%" />
<col width="9%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Design Label</th>
<th align="left">Estimand Label</th>
<th align="left">Estimator Label</th>
<th align="left">Bias</th>
<th align="left">RMSE</th>
<th align="left">Power</th>
<th align="left">Coverage</th>
<th align="left">Mean Estimate</th>
<th align="left">SD Estimate</th>
<th align="left">Mean Se</th>
<th align="left">Type S Rate</th>
<th align="left">Mean Estimand</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">design</td>
<td align="left">ate</td>
<td align="left">No control</td>
<td align="left">0.00</td>
<td align="left">0.32</td>
<td align="left">0.86</td>
<td align="left">0.95</td>
<td align="left">1.00</td>
<td align="left">0.32</td>
<td align="left">0.32</td>
<td align="left">0.00</td>
<td align="left">1.00</td>
</tr>
<tr class="even">
<td align="left">design</td>
<td align="left">ate</td>
<td align="left">With control</td>
<td align="left">-1.17</td>
<td align="left">1.18</td>
<td align="left">0.13</td>
<td align="left">0.00</td>
<td align="left">-0.17</td>
<td align="left">0.18</td>
<td align="left">0.17</td>
<td align="left">0.97</td>
<td align="left">1.00</td>
</tr>
</tbody>
</table>
<p>We see that the estimator without controls is unbiased while the one with controls is very biased. Clearly, introducing a control was a mistake, even though the control was pretreatment.</p>
<p>The reason why the estimator without controls is unbiased is simple enough: <span class="math inline">\(U_2\)</span> is correlated with <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> (via <span class="math inline">\(Z\)</span>), however it is not correlated with <span class="math inline">\(Y\)</span> given <span class="math inline">\(Z\)</span>. Indeed, in the model given, it is as if <span class="math inline">\(Z\)</span> is randomly assigned by <span class="math inline">\(U_2\)</span>.</p>
<p>The reason why the estimator with controls behaves so poorly is not as obvious. Conditioning on <span class="math inline">\(X\)</span> <em>introduces</em> a correlation between <span class="math inline">\(Y\)</span> and <span class="math inline">\(Z\)</span> that is not due to the effect of <span class="math inline">\(Z\)</span> on <span class="math inline">\(Y\)</span>. In the language used by researchers working with graphical causal models, <span class="math inline">\(X\)</span> is a “collider” for <span class="math inline">\(U_1\)</span> and <span class="math inline">\(U_2\)</span>. Conditioning on <span class="math inline">\(X\)</span> creates a “backdoor path” between <span class="math inline">\(Z\)</span> and <span class="math inline">\(Y\)</span>, inducing a correlation between them that is not a result of the causal effect.</p>
<p>For a little more intuition, we can modify the design to look at a world in which <span class="math inline">\(Z\)</span> does not affect <span class="math inline">\(Y\)</span>:</p>
<pre class="r"><code>null_design &lt;- redesign(design, N = 5000, b = 0)</code></pre>
<p>Diagnosis yields:</p>
<table>
<thead>
<tr class="header">
<th align="left">estimator_label</th>
<th align="right">bias</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">No control</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">With control</td>
<td align="right">-1.17</td>
</tr>
</tbody>
</table>
<p>We still observe bias. To see where this bias is coming from, let us draw data from this design and plot the relationship between <span class="math inline">\(Z\)</span> and <span class="math inline">\(Y\)</span>. Doing so lets us see how <span class="math inline">\(Z\)</span> and <span class="math inline">\(Y\)</span> relate to to each other for different values of <span class="math inline">\(X\)</span>.</p>
<pre class="r"><code>draw_data(null_design) %&gt;%
  ggplot(aes(X, Y, color = as.factor(Z))) +
  geom_point(alpha = 0.5) +
  geom_vline(xintercept = seq(-4, 4, 2)) +
  scale_color_manual(values = c(&quot;blue&quot;, &quot;red&quot;))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-9"></span>
<img src="/blog/2018-09-12-controlling-pretreatment-covariates_files/figure-html/unnamed-chunk-9-1.png" alt="Note: Correlation between Z and Y introduced by controlling for X." width="672" />
<p class="caption">
Figure 1: Note: Correlation between Z and Y introduced by controlling for X.
</p>
</div>
<p>What we see here is that, overall, the red points are no higher or lower than the blue points — indicating no treatment effect. Yet <em>within any vertical band</em> (i.e., keeping <span class="math inline">\(X\)</span> fixed), the blue dots are generally higher than the red dots. Conditioning induces a non-causal correlation.</p>
<p>The implication is quite a deep one: models of data generating processes are sometimes required in order to justify the choice of statistical models.</p>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-greenland1999causal">
<p>Greenland, Sander, Judea Pearl, and James M Robins. 1999. “Causal Diagrams for Epidemiologic Research.” <em>Epidemiology</em>, 37–48.</p>
</div>
<div id="ref-rosenbaum2002observational">
<p>Rosenbaum, Paul R. 2002. <em>Observational Studies</em>. Springer.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>In contrast to the regression approach examined here, Bayesian approaches that model the causal structure could use information on <span class="math inline">\(X\)</span> without introducing the kinds of problems presented here.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>

        </div>
      </article>
      



    </div>
  </div>
</main>

    </div>

    

<footer>
    <div class="footer-top">
      <div class="container">
        <div class="row no-gutters">
          <div class="col-lg-7 col-md-12">
            <div class="row">
              <div class="col-md-3 col-12">
                <div class="footer-brand"><a href=""><img src="/images/brand-footer.svg" alt=""></a></div>
              </div>
              <div class="col-md-3 col-4">
                <p>DeclareDesign</p>
                <ul class="list-unstyled">
                  <li><a href="/">Home</a></li>
                  <li><a href="/about.html">About</a></li>
                  <li><a href="/r/designlibrary">Library</a></li>
                  <li><a href="/blog.html">Blog</a></li>
                  <li><a href="http://discuss.declaredesign.org/">Help</a></li>
                </ul>
              </div>
              <div class="col-md-3 col-4">
                <p>Software</p>
                <ul class="list-unstyled">
                  <li><a href="/r/declaredesign/">DeclareDesign</a></li>
                  <li><a href="/r/estimatr/">estimatr</a></li>
                  <li><a href="/r/randomizr/">randomizr</a></li>
                  <li><a href="/r/fabricatr/">fabricatr</a></li>
                  <li><a href="/r/designlibrary/">DesignLibrary</a></li>
                </ul>
              </div>
              
            </div>
          </div>
          <div class="col-lg-5 col-md-12"></div>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <div class="footer-meta-block">
        <div class="container">
          <div class="row align-items-center">
            <div class="col-sm-7">
              <p class="mb-0">&copy; 2021 Graeme Blair, Jasper Cooper, Alexander Coppock, and Macartan Humphreys</p>
            </div>
            <div class="col-sm-5">
              <div class="fbl-link-wrap">
                <ul class="list-inline mb-0">
                  <li class="list-inline-item"> <a target="_blank" href="http://github.com/DeclareDesign/"><img src="images/icon-git.svg" alt=""></a> </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
  
   
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/v/bs4/dt-1.10.18/datatables.min.css"/>
<script src="https://cdn.datatables.net/v/bs4/dt-1.10.18/datatables.min.js"></script>

<script>
    jQuery(function ()
    {
        const library_list = jQuery("#design_library_list");
        library_list.addClass("table table-striped table-bordered");
        library_list.DataTable(
            {
                "autoWidth": false,
                "columns":
                    [
                        {"width": "30%"}, 
                        {"width": "10%"}, 
                        {"width": "10%"}, 
                        {"width": "10%"}, 
                        {"width": "15%"}, 
                        {"width": "25%"}, 
                    ],
                "drawCallback": initialize_tooltips
            }
        );

        library_list.css("width", "");
    });

    function initialize_tooltips()
    {
        const tooltip_elements = jQuery('[data-toggle="tooltip"]');
        tooltip_elements.tooltip();
        tooltip_elements.click(function ()
        {
            jQuery(this).tooltip("hide");
        });
    }
</script>

    


<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>
jQuery(function ()
{
  $('pre').each(function (index)
  {
    hljs.highlightBlock(this);
  });
});
</script>



    
<script src="/js/math-code.js"></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    



    
  </body>
</html>

