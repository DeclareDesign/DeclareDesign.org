<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.79.1" />


  <title>An instrument does not have to be exogenous to be consistent - DeclareDesign</title>




  









<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css'>



<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>

<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">

<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>






  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="An instrument does not have to be exogenous to be consistent">
  <meta name="twitter:description" content='We often think of an instrumental variable ((Z)) as a random shock that generates exogenous variation in a treatment of interest (X). The randomness of (Z) lets us identify the effect of (X) on (Y), at least for units for which (Z) perturbs (X) in a way that’s not possible by just looking at the relationship between (X) and (Y). But surprisingly, we think, if effects are constant the instrumental variables estimator can be consistent for the effect of (X) on (Y) even when the relationship between the instrument ((Z)) and the endogenous variable ((X)) is confounded (for example, Hernán and Robins (2006)). That’s the good news. Less good news is that when there is effect heterogeneity you can get good estimates for some units but it can be hard to know which units those are (Swanson and Hernán 2017). We use a declaration and diagnosis to illustrate these insights. 
'>






<script src="/js/dropdown_menu.js"></script>
<link rel="stylesheet" href="/css/custom.css">

  </head>
  <body>
    <div class="wrapper">
      
        
<header>
  <div class="navbar-wrap fixed-top bg-white">
    <nav class="navbar navbar-expand-lg navbar-light">
      <div class="container-fluid"> <a class="navbar-brand" href="/"><img src="/images/brand.svg" alt=""></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item"><a class="nav-link" href="/getting-started.html">Getting Started</a></li>
            <li class="nav-item"><a class="nav-link" href="/r/designlibrary">Library</a></li>
            <li class="nav-item dropdown">
              
              <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Software <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="/r/declaredesign/">DeclareDesign</a></li>
                <li><a class="dropdown-item" href="/r/randomizr/">randomizr</a></li>
                <li><a class="dropdown-item" href="/r/fabricatr/">fabricatr</a></li>
                <li><a class="dropdown-item" href="/r/estimatr/">estimatr</a></li>
                <li><a class="dropdown-item" href="/r/designlibrary/">DesignLibrary</a></li>
              </ul>
            </li>
            <li class="nav-item"><a class="nav-link" href="/blog.html">Blog</a></li>
            <li class="nav-item"><a class="nav-link" href="/about.html">About</a></li>
            <li class="nav-item"><a target="_blank" class="nav-link" href="http://discuss.declaredesign.org/">Help</a></li>
          </ul>
        </div>
      </div>
    </nav>
  </div>
</header>

 

      


<main class="container">
  <div class="row justify-content-between">
    <div class="col-lg-12" id="content_column">
      <article class="article">

        <a class="h1 d-block mb-3" href="/blog">DeclareDesign Blog</a>
        <h2 class="article-title">An instrument does not have to be exogenous to be consistent</h2>

        
        <span class="article-date">2019/02/19</span>
        

        <div class="article-content">
          


<p>We often think of an instrumental variable (<span class="math inline">\(Z\)</span>) as a random shock that generates exogenous variation in a treatment of interest <span class="math inline">\(X\)</span>. The randomness of <span class="math inline">\(Z\)</span> lets us identify the effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>, at least for units for which <span class="math inline">\(Z\)</span> perturbs <span class="math inline">\(X\)</span> in a way that’s not possible by just looking at the relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. But surprisingly, we think, if effects are constant the instrumental variables estimator can be consistent for the effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> even when the relationship between the instrument (<span class="math inline">\(Z\)</span>) and the endogenous variable (<span class="math inline">\(X\)</span>) is confounded (for example, <span class="citation">Hernán and Robins (2006)</span>). That’s the good news. Less good news is that when there is effect heterogeneity you can get good estimates for some units but it can be hard to know <em>which</em> units those are <span class="citation">(Swanson and Hernán 2017)</span>. We use a declaration and diagnosis to illustrate these insights.
<!-- We show first that instrumental variables approaches can do well even with confounded instruments if there are constant treatment effects. We then show that with a confounded instrument and effect heterogeneity  the interpretation of who the compliers are for "complier average effects" really depends on the nature of confounding.  --></p>
<p>Consider the causal graph below (a directed acyclic graph, or DAG). Here <span class="math inline">\(U_2\)</span> confounds the relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. That’s the usual thing and the reason for why you need something like an instrument in the first place. But now a binary <span class="math inline">\(U_1\)</span> also confounds the relationship between <span class="math inline">\(Z\)</span> and <span class="math inline">\(X\)</span> (see for instance Fig 2d <span class="citation">Swanson et al. (2018)</span>). To emphasize, in this set up, the instrumental variable and the <strong>instrumented</strong> variable share a common cause in <span class="math inline">\(U_1\)</span>.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-1"></span>
<img src="/blog/2019-02-19-instrumental-variables_files/figure-html/unnamed-chunk-1-1.png" alt="Figure: DAG for a non-randomized instrument. Z is an instrument for the effect of X on Y" width="50%" height="30%" />
<p class="caption">
Figure 1: Figure: DAG for a non-randomized instrument. Z is an instrument for the effect of X on Y
</p>
</div>
<p>Using <code>DeclareDesign</code>, we write down a declaration that is consistent with this DAG. Our declaration specifies some “compliance types” or “principal strata.” In the standard IV setup with a binary instrument <span class="math inline">\(Z\)</span> and a binary treatment <span class="math inline">\(X\)</span>, there are only four types (corresponding to all conceivable ways that the endogenous variable can respond to the exogenous variable): compliers, never-takers, always-takers, and defiers.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> But here, the binary <span class="math inline">\(U_1\)</span> and binary <span class="math inline">\(Z\)</span> both affect <span class="math inline">\(X\)</span>, so there are actually <strong>sixteen</strong> conceivable ways to comply!<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p>We simplify by imagining a world with only three types: <span class="math inline">\(U_1\)</span>-compliers, <span class="math inline">\(Z\)</span>-compliers, and never-takers.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> <span class="math inline">\(U_1\)</span>-compliers have <span class="math inline">\(X = 1\)</span> if and only if <span class="math inline">\(U_1 = 1\)</span>. <span class="math inline">\(Z\)</span>-compliers have <span class="math inline">\(X = 1\)</span> if and only if <span class="math inline">\(Z = 1\)</span>. Never-takers have <span class="math inline">\(X = 0\)</span> regardless of the values of <span class="math inline">\(U_1\)</span> or <span class="math inline">\(Z\)</span>. <span class="math inline">\(U_2\)</span> takes three values, 1-3, and plays two roles. First, it determines whether you are a <span class="math inline">\(U_1\)</span>-complier, <span class="math inline">\(Z\)</span>-complier, or never-taker with respect to <span class="math inline">\(X\)</span>. Second, it is positively correlated with your value in <span class="math inline">\(Y\)</span>.</p>
<p>We’ll define five estimands, which is a lot.</p>
<ol style="list-style-type: decimal">
<li>The Average Treatment Effect (ATE) of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>.</li>
<li>The Intention-To-Treat (ITT) effect. The average effect of <span class="math inline">\(Z\)</span> on <span class="math inline">\(Y\)</span>.</li>
<li>The first-stage effect. This is the average effect of <span class="math inline">\(Z\)</span> on <span class="math inline">\(X\)</span>.</li>
<li>The Local Average Treatment Effect (LATE_U1) of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>, among the subgroup of units that are <span class="math inline">\(U_1\)</span>-compliers</li>
<li>The Local Average Treatment Effect (LATE_Z) of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>, among the subgroup of units that are <span class="math inline">\(Z\)</span>-compliers</li>
</ol>
<p>We’ll use three estimators:</p>
<ol style="list-style-type: decimal">
<li>The ITT estimator, which is an OLS regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(Z\)</span>.</li>
<li>The first-stage estimator, which is an OLS regression of <span class="math inline">\(X\)</span> on <span class="math inline">\(Z\)</span>.</li>
<li>The IV estimator, which is two-stage least squares regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(X\)</span>, instrumented by <span class="math inline">\(Z\)</span>.</li>
</ol>
<p>The declaration also includes two additional parameters (bear with us!) that we’ll vary down below. They are:</p>
<ol style="list-style-type: decimal">
<li><code>heterogeneity</code>: the amount of treatment effect heterogeneity. When this is 0, the effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> is the same for <span class="math inline">\(U_1\)</span>-compliers as it is for <span class="math inline">\(Z\)</span>-compliers. Otherwise, the effect for the two subgroups is different.</li>
<li><code>path_weight</code>: describes whether the <code>U1 --&gt; X</code> or the <code>Z --&gt; X</code> path is stronger. This is equivalent to the fraction of compliers that are <span class="math inline">\(U_1\)</span>-compliers.</li>
</ol>
<p>OK, here’s the design:</p>
<pre class="r"><code>heterogeneity &lt;- 0   # how much does LATE_Z differ from LATE_U1?
path_weight   &lt;- .5  # what fraction of compliers are U1 compliers?

design &lt;-
  
  # U2 is the compliance &quot;type&quot; (U1 complier, Z complier, or Never Taker)
  declare_population(N = 2000, 
                     U2 = complete_ra(
                             N, 
                             prob_each = c(path_weight * 0.6, (1 - path_weight) * 0.6, 0.4), 
                             conditions = c(&quot;U1_c&quot;, &quot;Z_c&quot;, &quot;NT&quot;)),
                     noise = rnorm(N)) +
  
  # U1 is binary
  declare_assignment(prob = 0.5, assignment_variable = &quot;U1&quot;) +

  # Z is affected by U1: among U1 = 0, Z has probability 0.3; among U1 = 1, probability 0.6
  declare_assignment(blocks = U1, block_prob = c(0.3, 0.6), assignment_variable = &quot;Z&quot;) +
  
  # X potential outcomes in terms of U1 and Z, given U2 (there are **four**)
  declare_potential_outcomes(X ~ as.numeric((U2 == &quot;U1_c&quot;) * U1 +
                                            (U2 == &quot;Z_c&quot;)  * Z),
                             assignment_variables = c(U1, Z)) +

  # X potential outcomes in terms of Z given U1 and U2 (there are **two**)
  declare_potential_outcomes(X ~ as.numeric((U2 == &quot;U1_c&quot;) * U1 +
                                            (U2 == &quot;Z_c&quot;)  * Z),
                             assignment_variables = Z) +
  
  declare_reveal(X, assignment_variables = c(U1, Z)) +
  
  # Y potential outcomes in terms of X (there are **two**)
  declare_potential_outcomes(Y ~ X * (1 + heterogeneity * as.numeric(U2)) + noise, 
                             assignment_variables = X) +
  
  # Y potential outcomes in terms of Z (there are **two**)
  # this is same as above, but X is written in terms of Z
  declare_potential_outcomes(Y ~ as.numeric((U2 == &quot;U1_c&quot;) * U1 + (U2 == &quot;Z_c&quot;) * Z) * 
                              (1 + heterogeneity * as.numeric(U2)) + noise,
                              assignment_variables = Z) +
  
  # reveal Y (doesn&#39;t matter &quot;how&quot; this is revealed, either via the X pos or the Z pos)
  declare_reveal(Y, assignment_variables = X) +
  
  # Use X POs to learn about the two complier definitions
  declare_step(
    U1_complier = X_U1_0_Z_0 == 0 &amp; X_U1_0_Z_1 == 0 &amp; X_U1_1_Z_0 == 1 &amp; X_U1_1_Z_1 == 1,
    Z_complier  = X_U1_0_Z_0 == 0 &amp; X_U1_1_Z_0 == 0 &amp; X_U1_0_Z_1 == 1 &amp; X_U1_1_Z_1 == 1, 
    handler = fabricate) +
  
  # 5 (!) estimands
  declare_estimand(
    ATE =         mean(Y_X_1 - Y_X_0),
    LATE_U1 =     mean(Y_X_1[U1_complier] - Y_X_0[U1_complier]),
    LATE_Z =      mean(Y_X_1[Z_complier] - Y_X_0[Z_complier]),
    ITT =         mean(Y_Z_1 - Y_Z_0),
    first_stage = mean(X_Z_1) - mean(X_Z_0)) + 
  
  # Three estimators
  declare_estimator(Y ~ Z, estimand = &quot;ITT&quot;, model = lm_robust, label =  &quot;itt&quot;) +
  declare_estimator(X ~ Z, estimand = &quot;first_stage&quot;, model = lm_robust, label =  &quot;first&quot;) +
  declare_estimator(Y ~ X | Z, estimand = c(&quot;ATE&quot;, &quot;LATE_U1&quot;, &quot;LATE_Z&quot;), 
                              model = iv_robust, label =  &quot;iv_robust&quot;)</code></pre>
<p>Let’s now diagnose this design to show that – pretty counterintuitively for us at least! – the IV estimator still recovers the LATE even when <span class="math inline">\(Z\)</span> and <span class="math inline">\(X\)</span> have a common cause.</p>
<pre class="r"><code>diagnosis_1 &lt;- 
  diagnose_design(
    design, diagnosands = declare_diagnosands(select = c(bias, mean_estimate, mean_estimand)))</code></pre>
<table style="width:100%;">
<colgroup>
<col width="13%" />
<col width="15%" />
<col width="22%" />
<col width="5%" />
<col width="7%" />
<col width="7%" />
<col width="14%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Design Label</th>
<th align="left">Estimand Label</th>
<th align="left">Estimator Label</th>
<th align="left">Term</th>
<th align="left">N Sims</th>
<th align="left">Bias</th>
<th align="left">Mean Estimate</th>
<th align="left">Mean Estimand</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">design</td>
<td align="left">ATE</td>
<td align="left">iv_robust</td>
<td align="left">X</td>
<td align="left">200</td>
<td align="left">-0.00</td>
<td align="left">1.00</td>
<td align="left">1.00</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(0.01)</td>
<td align="left">(0.01)</td>
<td align="left">(0.00)</td>
</tr>
<tr class="odd">
<td align="left">design</td>
<td align="left">first_stage</td>
<td align="left">lm_robust_first_stage</td>
<td align="left">Z</td>
<td align="left">200</td>
<td align="left">0.09</td>
<td align="left">0.39</td>
<td align="left">0.30</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(0.00)</td>
<td align="left">(0.00)</td>
<td align="left">(0.00)</td>
</tr>
<tr class="odd">
<td align="left">design</td>
<td align="left">ITT</td>
<td align="left">lm_robust_itt</td>
<td align="left">Z</td>
<td align="left">200</td>
<td align="left">0.09</td>
<td align="left">0.39</td>
<td align="left">0.30</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(0.00)</td>
<td align="left">(0.00)</td>
<td align="left">(0.00)</td>
</tr>
<tr class="odd">
<td align="left">design</td>
<td align="left">LATE_U1</td>
<td align="left">iv_robust</td>
<td align="left">X</td>
<td align="left">200</td>
<td align="left">-0.00</td>
<td align="left">1.00</td>
<td align="left">1.00</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(0.01)</td>
<td align="left">(0.01)</td>
<td align="left">(0.00)</td>
</tr>
<tr class="odd">
<td align="left">design</td>
<td align="left">LATE_Z</td>
<td align="left">iv_robust</td>
<td align="left">X</td>
<td align="left">200</td>
<td align="left">-0.00</td>
<td align="left">1.00</td>
<td align="left">1.00</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(0.01)</td>
<td align="left">(0.01)</td>
<td align="left">(0.00)</td>
</tr>
</tbody>
</table>
<p>Let’s take the diagnosis estimand-by-estimand:</p>
<ol style="list-style-type: decimal">
<li>The ATE is well-estimated by the instrumental variables estimator. This, despite the fact that:</li>
<li>The first stage regression estimates are biased for the average effect of <span class="math inline">\(Z\)</span> on <span class="math inline">\(X\)</span> because of the unobserved confounder <span class="math inline">\(U_1\)</span>.</li>
<li>The ITT estimates are <strong>also</strong> biased because of the confounding between <span class="math inline">\(Y\)</span> and <span class="math inline">\(Z\)</span>.</li>
<li>The instrumental variables performs well for the LATE, as defined here. But in this case the LATE is the same as the ATE so this is not surprising.</li>
</ol>
<p>You see in the estimator column that the bias in the ITT and first stage estimates are proportionate, such that, in the ratio, the bias cancels out. We provide some intuition for this result below, where we show how it can also break down.</p>
<p>The upshot is that when assessing the validity of IV you might be imposing an additional assumption that you might not need to impose. This may be good news in some specific research settings where the more stringent assumption of exogenous assignment of <span class="math inline">\(X\)</span> to <span class="math inline">\(Z\)</span> is not well justified.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<div id="allowing-heterogeneity" class="section level1">
<h1>Allowing heterogeneity</h1>
<p>We show here that we lose the ability to estimate the effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> when this effect varies among compliance types – the <span class="math inline">\(U_1\)</span>-compliers, the <span class="math inline">\(Z\)</span>-compliers, and the never-takers.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> We can quickly redesign to allow heterogeneity, and see that now, we are biased for all the estimands!</p>
<pre class="r"><code>design_h &lt;- redesign(design, heterogeneity = 1)

diagnosis_2 &lt;- 
  diagnose_design(
    design_h, diagnosands = declare_diagnosands(select = c(bias, mean_estimate, mean_estimand)))</code></pre>
<table>
<colgroup>
<col width="11%" />
<col width="12%" />
<col width="13%" />
<col width="19%" />
<col width="4%" />
<col width="6%" />
<col width="6%" />
<col width="12%" />
<col width="12%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Design Label</th>
<th align="left">heterogeneity</th>
<th align="left">Estimand Label</th>
<th align="left">Estimator Label</th>
<th align="left">Term</th>
<th align="left">N Sims</th>
<th align="left">Bias</th>
<th align="left">Mean Estimate</th>
<th align="left">Mean Estimand</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">design_h</td>
<td align="left">1</td>
<td align="left">ATE</td>
<td align="left">iv_robust</td>
<td align="left">X</td>
<td align="left">200</td>
<td align="left">-0.33</td>
<td align="left">2.77</td>
<td align="left">3.10</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(0.01)</td>
<td align="left">(0.01)</td>
<td align="left">(0.00)</td>
</tr>
<tr class="odd">
<td align="left">design_h</td>
<td align="left">1</td>
<td align="left">first_stage</td>
<td align="left">lm_robust_first_stage</td>
<td align="left">Z</td>
<td align="left">200</td>
<td align="left">0.09</td>
<td align="left">0.39</td>
<td align="left">0.30</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(0.00)</td>
<td align="left">(0.00)</td>
<td align="left">(0.00)</td>
</tr>
<tr class="odd">
<td align="left">design_h</td>
<td align="left">1</td>
<td align="left">ITT</td>
<td align="left">lm_robust_itt</td>
<td align="left">Z</td>
<td align="left">200</td>
<td align="left">0.18</td>
<td align="left">1.08</td>
<td align="left">0.90</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(0.00)</td>
<td align="left">(0.00)</td>
<td align="left">(0.00)</td>
</tr>
<tr class="odd">
<td align="left">design_h</td>
<td align="left">1</td>
<td align="left">LATE_U1</td>
<td align="left">iv_robust</td>
<td align="left">X</td>
<td align="left">200</td>
<td align="left">0.77</td>
<td align="left">2.77</td>
<td align="left">2.00</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(0.01)</td>
<td align="left">(0.01)</td>
<td align="left">(0.00)</td>
</tr>
<tr class="odd">
<td align="left">design_h</td>
<td align="left">1</td>
<td align="left">LATE_Z</td>
<td align="left">iv_robust</td>
<td align="left">X</td>
<td align="left">200</td>
<td align="left">-0.23</td>
<td align="left">2.77</td>
<td align="left">3.00</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">(0.01)</td>
<td align="left">(0.01)</td>
<td align="left">(0.00)</td>
</tr>
</tbody>
</table>
<p>Why was the bias so much lower under homogeneous effects of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> for compliers?</p>
<p>Here’s some intuition. In both the heterogeneous and homogeneous cases, we misattribute some of the effect of <span class="math inline">\(U_1\)</span> on <span class="math inline">\(X\)</span> to the effect of <span class="math inline">\(Z\)</span> on <span class="math inline">\(X\)</span>, because those for whom <span class="math inline">\(U_1 = 1\)</span> are also more likely to have <span class="math inline">\(Z = 1\)</span>. Thus, we overestimate the first stage in proportion to this misattribution. In both the homogeneous and heterogeneous cases, we estimate that <span class="math inline">\(Z\)</span> increases the probability of <span class="math inline">\(X = 1\)</span> by 39pp on average, whereas the true effect is 30pp. When we compute the effect of <span class="math inline">\(Z\)</span> on <span class="math inline">\(Y\)</span> for the ITT, those <span class="math inline">\(U_1\)</span>-compliers that we mistook for <span class="math inline">\(Z\)</span>-compliers also produce an effect on <span class="math inline">\(Y\)</span> that we again misattribute to <span class="math inline">\(Z\)</span>, though in fact it was caused by the effect of <span class="math inline">\(U_1\)</span> running through <span class="math inline">\(X\)</span>. The extent of this misattribution in the ITT is the same as the extent of the misattribution in the first stage when the effects of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> are homogeneous. Thus, even though we wanted to divide 0.3 / 0.3 to get 1, we ended up dividing 0.39 / 0.39 – and we still got 1! When the effects are heterogeneous, however, we lose this proportionality: because the effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> is bigger now for <span class="math inline">\(Z\)</span>-compliers than for <span class="math inline">\(U_1\)</span> compliers, <em>our estimate of the ITT is not biased enough!</em>. We would have wanted to estimate an ITT of 1.20 so that our IV estimator would have given us the true ATE via 1.20 / 0.39 = 3.10. But instead, we misattribute the <span class="math inline">\(U_1\)</span>-compliers’ effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> to the <span class="math inline">\(Z\)</span>-compliers in a way that is disproportionate to the misattribution of the first stage, <span class="math inline">\(Z\)</span> on <span class="math inline">\(X\)</span>. We don’t have enough bias to unbias our estimates!</p>
</div>
<div id="with-non-causal-instruments-the-compliers-are-those-that-comply-with-respect-to-the-unobserved-causal-instrument" class="section level1">
<h1>With non causal instruments the “compliers” are those that comply with respect to the unobserved causal instrument</h1>
<p>Although we have described <span class="math inline">\(Z\)</span> as being the instrument, you can see in this DAG that both <span class="math inline">\(Z\)</span> and <span class="math inline">\(U_1\)</span> can affect <span class="math inline">\(X\)</span>. So perhaps <span class="math inline">\(U_1\)</span> should thought of as an instrument even if it is unobserved? And perhaps compliers should be thought of as units that comply with <span class="math inline">\(U_1\)</span> and not <span class="math inline">\(Z\)</span>?</p>
<p>To explore this possibility, we diagnose design modifications that shift probability mass between two special cases of the DAG.</p>
<p>The first special case is the standard IV setup with no arrow between <span class="math inline">\(U_1\)</span> and <span class="math inline">\(X\)</span>. The second special case is one discussed in <span class="citation">Swanson and Hernán (2017)</span> in which <span class="math inline">\(Z\)</span> is a “noncausal instrument” and the true causal instrument is the unobserved <span class="math inline">\(U_1\)</span>. We get this by removing the path from <span class="math inline">\(Z\)</span> to <span class="math inline">\(X\)</span>. <span class="citation">Swanson and Hernán (2017)</span> show that <strong>even though</strong> <span class="math inline">\(Z\)</span> does not itself affect <span class="math inline">\(X\)</span>, instrumenting <span class="math inline">\(X\)</span> with <span class="math inline">\(Z\)</span> will recover good estimates of a well-defined estimand. You guessed it, that estimand is the LATE for <span class="math inline">\(U_1\)</span> compliers. Amazing!</p>
<p>These cases are the two extremes of a continuum of the relative strength of the two paths. To be clear those two paths are <code>U1 --&gt; X</code> and <code>Z --&gt; X</code>. We can adjust the strength of those two paths with the <code>path_weight</code> parameter in our design. For this last simulation, we’ll consider 5 values for this parameter between 0 and 1.</p>
<pre class="r"><code>designs &lt;- redesign(design, heterogeneity = 1, path_weight = seq(0.01, .99, length = 5))

diagnosis_3 &lt;- diagnose_design(
    designs, diagnosands = declare_diagnosands(select = c(bias, mean_estimate, mean_estimand)))</code></pre>
<p><img src="/blog/2019-02-19-instrumental-variables_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Let’s consider the graph from left to right.</p>
<p>All the way to the left, all the compliers are <span class="math inline">\(Z\)</span> compliers. Equivalently, all the way to the left, <span class="math inline">\(U_1\)</span> has no effect on <span class="math inline">\(X\)</span>. That’s the standard IV setup in which <span class="math inline">\(Z\)</span> is as-if randomized, so our estimates of the ITT, the first stage, and the LATE are all on target.</p>
<p>All the way to the right, all the compliers are <span class="math inline">\(U_1\)</span>-compliers, because <span class="math inline">\(Z\)</span> has no effect on <span class="math inline">\(X\)</span>. That’s the “non causal instrument” case described in <span class="citation">Swanson and Hernán (2017)</span> (see also <span class="citation">Brito and Pearl (2002)</span>). The estimates of everything else – the ITT, the first stage, and the ATE are all quite biased, but the IV estimator does a good job of estimating the LATE among <span class="math inline">\(U_1\)</span>-compliers.</p>
<p>In between the leftmost and rightmost extremes, however, our estimates of all of the estimands are biased. Indeed, the middle case (at the <code>0.50</code> mark) is exactly the situation we described in the “Allowing heterogeneity” section above. It’s possible (and we’d love to hear from you if you have ideas along these lines!) that an alternative estimation strategy would recover good estimates of one or more of these estimands.</p>
</div>
<div id="blog-update" class="section level1">
<h1>Blog update</h1>
<p>This will be the last of our weekly blog posts on <a href="declaredesign.org">declaredesign.org</a>. When we started blogging, we set ourselves a goal of six months of posts. We really enjoyed putting these posts together, but we’re also excited to shift attention to other parts of the project. We expect to continue to post occasionally here and to put up more informal posts on <a href="http://discuss.declaredesign.org">http://discuss.declaredesign.org</a> and we’d love it if you joined us there.</p>
<p>Yours in declaration and diagnosis,</p>
<p>Graeme, Jasper, Alex, and Macartan</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-brito2002generalized">
<p>Brito, Carlos, and Judea Pearl. 2002. “Generalized Instrumental Variables.” In <em>Proceedings of the Eighteenth Conference on Uncertainty in Artificial Intelligence</em>, 85–93. Morgan Kaufmann Publishers Inc.</p>
</div>
<div id="ref-hernan2006instruments">
<p>Hernán, Miguel A, and James M Robins. 2006. “Instruments for Causal Inference: An Epidemiologist’s Dream?” <em>Epidemiology</em>, 360–72.</p>
</div>
<div id="ref-Swanson2017">
<p>Swanson, Sonja A, and Miguel A Hernán. 2017. “The challenging interpretation of instrumental variable estimates under monotonicity.” <em>International Journal of Epidemiology</em> 47 (4): 1289–97.</p>
</div>
<div id="ref-swanson2018partial">
<p>Swanson, Sonja A, Miguel A Hernán, Matthew Miller, James M Robins, and Thomas S Richardson. 2018. “Partial Identification of the Average Treatment Effect Using Instrumental Variables: Review of Methods for Binary Instruments, Treatments, and Outcomes.” <em>Journal of the American Statistical Association</em> 113 (522): 933–47.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Denoting <span class="math inline">\(x\)</span> the value that the endogenous variable <span class="math inline">\(X\)</span> takes, compliers have <span class="math inline">\(x = f_X(Z) = Z\)</span>, never-takers have <span class="math inline">\(x = f_X(Z) = 0\)</span>, always-takers have <span class="math inline">\(x = f_X(Z) = 1\)</span>, and defiers have <span class="math inline">\(x = f_X(Z) = (1 - Z)\)</span>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>The value <span class="math inline">\(X\)</span> takes could depend on all four potential combinations of <span class="math inline">\(U_1\)</span> and <span class="math inline">\(Z\)</span>. So if <span class="math inline">\(x = f_X(U_1,Z)\)</span>, you have to think about every possible way in which <span class="math inline">\(f_X(0,0)\)</span>, <span class="math inline">\(f_X(1,0)\)</span>, <span class="math inline">\(f_X(0,1)\)</span> and <span class="math inline">\(f_X(0,0)\)</span> can map into values of <span class="math inline">\(x\)</span>.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>The assumption that there are no types who “defy” their <span class="math inline">\(U_1\)</span> or <span class="math inline">\(Z\)</span> assignments amounts to a monotonicity assumption common in the IV framework.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Of course, the result also holds when <span class="math inline">\(Z\)</span> and <span class="math inline">\(X\)</span> are unconfounded, which also allows for unbiased estimation of the ITT and the first stage, which may be of practical or theoretical interest in and of themselves.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>More precisely, weaker conditions than homogeneity can be sufficient for identification. As put by <span class="citation">Hernán and Robins (2006)</span>, a sufficient assumption is that “the X-Y causal risk difference is the same among treated subjects with <span class="math inline">\(Z=1\)</span> as among treated subjects with <span class="math inline">\(Z=0\)</span>, and similarly among untreated subjects.” See other conditions discussed in <span class="citation">Swanson et al. (2018)</span>.<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>

        </div>
      </article>
      



    </div>
  </div>
</main>

    </div>

    

<footer>
    <div class="footer-top">
      <div class="container">
        <div class="row no-gutters">
          <div class="col-lg-7 col-md-12">
            <div class="row">
              <div class="col-md-3 col-12">
                <div class="footer-brand"><a href=""><img src="/images/brand-footer.svg" alt=""></a></div>
              </div>
              <div class="col-md-3 col-4">
                <p>DeclareDesign</p>
                <ul class="list-unstyled">
                  <li><a href="/">Home</a></li>
                  <li><a href="/about.html">About</a></li>
                  <li><a href="/r/designlibrary">Library</a></li>
                  <li><a href="/blog.html">Blog</a></li>
                  <li><a href="http://discuss.declaredesign.org/">Help</a></li>
                </ul>
              </div>
              <div class="col-md-3 col-4">
                <p>Software</p>
                <ul class="list-unstyled">
                  <li><a href="/r/declaredesign/">DeclareDesign</a></li>
                  <li><a href="/r/estimatr/">estimatr</a></li>
                  <li><a href="/r/randomizr/">randomizr</a></li>
                  <li><a href="/r/fabricatr/">fabricatr</a></li>
                  <li><a href="/r/designlibrary/">DesignLibrary</a></li>
                </ul>
              </div>
              
            </div>
          </div>
          <div class="col-lg-5 col-md-12"></div>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <div class="footer-meta-block">
        <div class="container">
          <div class="row align-items-center">
            <div class="col-sm-7">
              <p class="mb-0">&copy; 2021 Graeme Blair, Jasper Cooper, Alexander Coppock, and Macartan Humphreys</p>
            </div>
            <div class="col-sm-5">
              <div class="fbl-link-wrap">
                <ul class="list-inline mb-0">
                  <li class="list-inline-item"> <a target="_blank" href="http://github.com/DeclareDesign/"><img src="images/icon-git.svg" alt=""></a> </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
  
   
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/v/bs4/dt-1.10.18/datatables.min.css"/>
<script src="https://cdn.datatables.net/v/bs4/dt-1.10.18/datatables.min.js"></script>

<script>
    jQuery(function ()
    {
        const library_list = jQuery("#design_library_list");
        library_list.addClass("table table-striped table-bordered");
        library_list.DataTable(
            {
                "autoWidth": false,
                "columns":
                    [
                        {"width": "30%"}, 
                        {"width": "10%"}, 
                        {"width": "10%"}, 
                        {"width": "10%"}, 
                        {"width": "15%"}, 
                        {"width": "25%"}, 
                    ],
                "drawCallback": initialize_tooltips
            }
        );

        library_list.css("width", "");
    });

    function initialize_tooltips()
    {
        const tooltip_elements = jQuery('[data-toggle="tooltip"]');
        tooltip_elements.tooltip();
        tooltip_elements.click(function ()
        {
            jQuery(this).tooltip("hide");
        });
    }
</script>

    


<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script>
jQuery(function ()
{
  $('pre').each(function (index)
  {
    hljs.highlightBlock(this);
  });
});
</script>



    
<script src="/js/math-code.js"></script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    



    
  </body>
</html>

