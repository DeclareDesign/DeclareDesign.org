<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cluster Sampling • DesignLibrary</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Cluster Sampling">
<meta property="og:description" content="DesignLibrary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="https://declaredesign.org"><img height="125%" src="https://declaredesign.org/images/brand.svg"></a>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Software
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://declaredesign.org/r/declaredesign/">DeclareDesign</a>
    </li>
    <li>
      <a href="https://declaredesign.org/r/randomizr/">randomizr</a>
    </li>
    <li>
      <a href="https://declaredesign.org/r/fabricatr/">fabricatr</a>
    </li>
    <li>
      <a href="https://declaredesign.org/r/estimatr/">estimatr</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://discuss.declaredesign.org">Help</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/How_to_Write_and_Contribute_Designers.html">How to Write and Contribute Designers</a>
    </li>
    <li>
      <a href="../articles/How_to_Write_and_Contribute_Designs.html">How to Write and Contribute Designs</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://declaredesign.org/r/designlibrary/">DesignLibrary home</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->




      

      </header><script src="cluster_sampling_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Cluster Sampling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DeclareDesign/DesignLibrary/blob/master/../vignettes/cluster_sampling.Rmd"><code>../vignettes/cluster_sampling.Rmd</code></a></small>
      <div class="hidden name"><code>cluster_sampling.Rmd</code></div>

    </div>

    
    
<p>Researchers often cannot randomly sample at the individual level because it may, among other reasons, be too costly or logistically impractical. Instead, they may choose to randomly sample households, political precincts, or any group of individuals in order to draw inferences about the population. This strategy may be cheaper and simpler but may also introduce risks of less precise estimates.</p>
<!-- Include reference to simple random sampling vignette below -->
<!-- In *Simple Random Sampling*, we discused the example of estimating the average political ideology in Portola, California. Consider instead  -->
<p>Say we are interested in the average party ideology in the entire state of California. Using cluster sampling, we randomly sample counties within the state, and within each selected county, randomly sample individuals to survey.</p>
<p>Assuming enough variation in the outcome of interest, the random assignment of equal-sized clusters yields unbiased but imprecise estimates. By sampling clusters, we select groups of individuals who may share common attributes. Unlike simple random sampling, we need to take account of this intra-cluster correlation in our estimation of the standard error.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> The higher the degree of within-cluster similarity, the more variance we observe in cluster-level averages and the more imprecise are our estimates.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> We address this by considering cluster-robust standard errors in our answer strategy below.</p>
<div id="design-declaration" class="section level2">
<h2 class="hasAnchor">
<a href="#design-declaration" class="anchor"></a>Design Declaration</h2>
<ul>
<li>
<p><strong>M</strong>odel:</p>
<p>We specify the variable of interest <span class="math inline">\(Y\)</span> (political ideology, say) as a discrete variable ranging from 1 (most liberal) to 7 (most conservative). We do not define a functional model since we are interested in the population mean of <span class="math inline">\(Y\)</span>. The model also includes information about the number of sampled clusters and the number of individuals per cluster.</p>
</li>
<li>
<p><strong>I</strong>nquiry:</p>
<p>Our estimand is the population mean of political identification <span class="math inline">\(Y\)</span>. Because we employed random sampling, we can expect the value of the sample mean (<span class="math inline">\(\widehat{\overline{y}}\)</span>) to approximate the true population parameter (<span class="math inline">\(\widehat{\overline{Y}}\)</span>).</p>
</li>
<li>
<p><strong>D</strong>ata strategy:</p>
<p>Sampling follows a two-stage strategy. We first draw a random sample 30 counties in California, and in each county select 20 individuals at random. This guarantees that each county has the same probability of being included in the sample and each resident within a county the same probability of being in the sample. In this design we estimate <span class="math inline">\(Y\)</span> for n = 600 respondents.</p>
</li>
<li>
<p><strong>A</strong>nswer strategy:</p>
<p>We estimate the population mean with the sample mean estimator: <span class="math inline">\(\widehat{\overline{Y}} = \frac{1}{n} \sum_1^n Y_i\)</span>, and estimate standard errors under the assumption of independent and heteroskedastic errors as well as cluster-robust standard errors to take into account correlation of errors within clusters. Below we demonstrate the the imprecision of our estimated <span class="math inline">\(\widehat{\overline{Y}}\)</span> when we cluster standard errors and when we do not in the presence of an intracluster correlation coefficient (ICC) of 0.402.</p>
</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">N_blocks</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">N_clusters_in_block</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="va">N_i_in_cluster</span> <span class="op">&lt;-</span> <span class="fl">50</span>
<span class="va">n_clusters_in_block</span> <span class="op">&lt;-</span> <span class="fl">30</span>
<span class="va">n_i_in_cluster</span> <span class="op">&lt;-</span> <span class="fl">20</span>
<span class="va">icc</span> <span class="op">&lt;-</span> <span class="fl">0.402</span>

<span class="va">fixed_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DeclareDesign/man/declare_population.html">declare_population</a></span><span class="op">(</span>block <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span>N <span class="op">=</span> <span class="va">N_blocks</span><span class="op">)</span>, 
    cluster <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span>N <span class="op">=</span> <span class="va">N_clusters_in_block</span><span class="op">)</span>, subject <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span>N <span class="op">=</span> <span class="va">N_i_in_cluster</span>, 
        latent <span class="op">=</span> <span class="fu">draw_normal_icc</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0</span>, N <span class="op">=</span> <span class="va">N</span>, clusters <span class="op">=</span> <span class="va">cluster</span>, 
            ICC <span class="op">=</span> <span class="va">icc</span><span class="op">)</span>, Y <span class="op">=</span> <span class="fu">draw_ordered</span><span class="op">(</span>x <span class="op">=</span> <span class="va">latent</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, 
            <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="op">)</span>
<span class="va">population</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DeclareDesign/man/declare_population.html">declare_population</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fixed_pop</span><span class="op">)</span>
<span class="va">estimand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DeclareDesign/man/declare_estimand.html">declare_estimand</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"Ybar"</span><span class="op">)</span>
<span class="va">stage_1_sampling</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DeclareDesign/man/declare_sampling.html">declare_sampling</a></span><span class="op">(</span>strata <span class="op">=</span> <span class="va">block</span>, clusters <span class="op">=</span> <span class="va">cluster</span>, 
    n <span class="op">=</span> <span class="va">n_clusters_in_block</span>, sampling_variable <span class="op">=</span> <span class="st">"Cluster_Sampling_Prob"</span><span class="op">)</span>
<span class="va">stage_2_sampling</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DeclareDesign/man/declare_sampling.html">declare_sampling</a></span><span class="op">(</span>strata <span class="op">=</span> <span class="va">cluster</span>, n <span class="op">=</span> <span class="va">n_i_in_cluster</span>, 
    sampling_variable <span class="op">=</span> <span class="st">"Within_Cluster_Sampling_Prob"</span><span class="op">)</span>
<span class="va">clustered_ses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DeclareDesign/man/declare_estimator.html">declare_estimator</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="fl">1</span>, model <span class="op">=</span> <span class="va">lm_robust</span>, 
    clusters <span class="op">=</span> <span class="va">cluster</span>, estimand <span class="op">=</span> <span class="va">estimand</span>, label <span class="op">=</span> <span class="st">"Clustered Standard Errors"</span><span class="op">)</span>
<span class="va">cluster_sampling_design</span> <span class="op">&lt;-</span> <span class="va">population</span> <span class="op">+</span> <span class="va">estimand</span> <span class="op">+</span> <span class="va">stage_1_sampling</span> <span class="op">+</span> 
    <span class="va">stage_2_sampling</span> <span class="op">+</span> <span class="va">clustered_ses</span></code></pre></div>
</div>
<div id="takeaways" class="section level2">
<h2 class="hasAnchor">
<a href="#takeaways" class="anchor"></a>Takeaways</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diagnosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DeclareDesign/man/diagnose_design.html">diagnose_design</a></span><span class="op">(</span><span class="va">cluster_sampling_design</span>, sims <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: We recommend you choose a higher number of simulations than 25 for the
## top level of simulation.</code></pre>
<table class="table">
<colgroup>
<col width="23%">
<col width="6%">
<col width="6%">
<col width="8%">
<col width="12%">
<col width="11%">
<col width="7%">
<col width="11%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left">Estimator Label</th>
<th align="left">RMSE</th>
<th align="left">Power</th>
<th align="left">Coverage</th>
<th align="left">Mean Estimate</th>
<th align="left">SD Estimate</th>
<th align="left">Mean Se</th>
<th align="left">Type S Rate</th>
<th align="left">Mean Estimand</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Clustered Standard Errors</td>
<td align="left">0.26</td>
<td align="left">1.00</td>
<td align="left">0.96</td>
<td align="left">3.96</td>
<td align="left">0.26</td>
<td align="left">0.26</td>
<td align="left">0.00</td>
<td align="left">3.99</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">(0.05)</td>
<td align="left">(0.00)</td>
<td align="left">(0.04)</td>
<td align="left">(0.05)</td>
<td align="left">(0.05)</td>
<td align="left">(0.00)</td>
<td align="left">(0.00)</td>
<td align="left">(0.00)</td>
</tr>
</tbody>
</table>
<p>To appreciate the role of clustering better we also plot simulated values of our estimand with standard errors not clustered and with clustered standard errors. To do this we first add an additional estimator to the design that does not take account of clusters.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_design</span> <span class="op">&lt;-</span> <span class="va">cluster_sampling_design</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/DeclareDesign/man/declare_estimator.html">declare_estimator</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="fl">1</span>,
                                        model <span class="op">=</span> <span class="va">lm_robust</span>,
                                        estimand <span class="op">=</span> <span class="va">estimand</span>,
                                        label <span class="op">=</span> <span class="st">"Naive Standard Errors"</span><span class="op">)</span>
<span class="va">diagnosis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DeclareDesign/man/diagnose_design.html">diagnose_design</a></span><span class="op">(</span><span class="va">new_design</span>, sims <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></code></pre></div>
<p><img src="cluster_sampling_files/figure-html/plot-1.png" width="700"></p>
<p>The figure above may give us the impression that our estimate with clustered standard errors is less precise, when in fact, it correctly accounts for the uncertainty surrounding our estimates. The blue lines in the graph demonstrate the estimates from simulations which contain our estimand. As our table and graphs show, the share of these simulations over the total number of simulations, also known as coverage, is (correctly) close to 95% in estimations with clustered standard errors and 54% in estimations without clustered standard errors. As expected, the mean estimate itself and the bias is the same in both specifications.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-murray1998design">
<p>Murray, David M. 1998. <em>Design and Analysis of Group-Randomized Trials</em>. Vol. 29. Monographs in Epidemiology &amp; B.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>The intra-cluster correlation coefficient (ICC) can be calculated directly and is a feature of this design.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>In ordinary least square (OLS) models, we assume errors are independent (error terms between individual observations are uncorrelated with each other) and homoskedastic (the size of errors is homogeneous across individuals). In reality, this is often not the case with cluster sampling.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Graeme Blair, Jasper Cooper, Alexander Coppock, Macartan Humphreys, Clara Bicalho, Neal Fultz, Lily Medina.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
